const BACKEND_URL="https://ajrom-twitter-clone.herokuapp.com/",EMPTY_HEART="♡",FULL_HEART="♥",POSTS=[];class Content{constructor(e,t,n,o){this.id=e,this.name=t,this.content=n,this._createdAt=o}createdAt(){let e=this._createdAt.substring(0,10).split("-");return`( ${e[1]}/${e[2]}/${e[0]} )`}}class Post extends Content{constructor(e,t,n,o,s,a){super(e,t,n,o),this.comments=s,this.likes=a,POSTS.push(this)}toModal(){let e=document.getElementById("modal");e.classList.remove("hidden");let t=document.createElement("article");t.classList.add("post-modal"),t.id=this.id;let n=document.createElement("h1");n.textContent=this.name+" "+this.createdAt();let o=document.createElement("p");o.textContent=this.content;let s=document.createElement("div");s.textContent=this.likes+" Likes";const a=getCloseModalButton(),d=getCommentForm(this);let c=document.createElement("header");if(c.append(n,o,s),this.comments.length>0){let e=document.createElement("ul"),n=document.createElement("h4");n.innerText="Comments",e.classList.add("comments"),this.comments.forEach(t=>{let n=new Comment(t.id,t.name,t.content,t.created_at);e.append(n.toListItem())}),t.append(c,n,e,d,a)}else t.append(c,d,a);return e.append(t),e}toCard(){let e=document.createElement("div");e.id=this.id,e.classList.add("card");let t=document.createElement("article");t.classList.add("post");let n=document.createElement("h2");n.innerText=this.name+" "+this.createdAt();let o=document.createElement("p");o.innerText=this.content;let s=this.likeButton();return t.append(n,o,s),e.append(t),e.addEventListener("click",()=>this.toModal()),e}likeButton(){let e=document.createElement("span");return e.textContent=EMPTY_HEART+" "+this.likes,e.classList.add("heart"),e.addEventListener("click",t=>{t.stopPropagation(),likePost(this.id).then(()=>e.textContent=FULL_HEART+" "+`${this.likes+1}`).then(()=>this.likes+=1)}),e}}class Comment extends Content{constructor(e,t,n,o){super(e,t,n,o)}toListItem(){let e=document.createElement("li");e.classList.add("comment");let t=document.createElement("h4");t.innerText=this.name+" "+this.createdAt();let n=document.createElement("p");return n.innerText=this.content,e.append(t,n),e}}function clearModal(){const e=document.getElementById("modal");e.classList.add("hidden"),e.childNodes.forEach(e=>e.remove())}function getCloseModalButton(){const e=document.createElement("button");return e.textContent="Close",e.classList.add("danger"),e.addEventListener("click",e=>clearModal()),e}function renderCard(e){const t=e.toCard();document.getElementById("posts").append(t)}function renderPosts(e){e.forEach(e=>renderCard(new Post(e.id,e.name,e.content,e.created_at,e.comments,e.likes)))}function fetchAllPosts(){return fetch(BACKEND_URL).then(e=>e.json()).then(e=>renderPosts(e)).catch(e=>handleError(e))}function getCommentForm(e){let t=document.createElement("h4");t.innerText="Leave a Comment";let n=document.createElement("form");n.classList.add("comment-form"),Formio.icons="fontawesome",Formio.createForm(n,getFormJSON("Comment","Leave your thoughts here!","The comments for this tweet.",!0,e.id)).then(e=>e.on("submit",e=>{addCommentToPost(e.data).then(t=>{document.querySelector("button.danger").click();let n=e.data;const o=new Date,s={minimumIntegerDigits:2,useGrouping:!1};n.created_at=`${o.getFullYear()}-${(o.getMonth()+1).toLocaleString("en-US",s)}-${o.getDate().toLocaleString("en-US",s)}`;const a=parseInt(n.post_id);let d=POSTS.find(e=>e.id===a);d.comments.push(n),d.toModal()})}));const o=document.createElement("div");return o.classList.add("form-container"),o.append(t,n),o}function getFormJSON(e,t,n,o=!1,s=0){let a={display:"form",settings:{pdf:{id:"1ec0f8ee-6685-5d98-a847-26f67b67d6f0",src:"https://files.form.io/pdf/5692b91fd1028f01000407e3/file/1ec0f8ee-6685-5d98-a847-26f67b67d6f0"}},components:[{label:"Name",labelPosition:"left-left",placeholder:"Name",description:"Your full name.",tableView:!0,validate:{required:!0,maxLength:100,minLength:5},key:"name",type:"textfield",input:!0},{label:e,placeholder:t,description:n,autoExpand:!1,tableView:!0,validate:{required:!0,maxLength:500,minLength:5},key:"content",type:"textarea",input:!0},{type:"button",label:"Submit",key:"submit",disableOnInvalid:!0,input:!0,tableView:!1}]};return o&&a.components.push({label:"post_id",defaultValue:s.toString(),key:"post_id",type:"hidden",input:!0,tableView:!1}),a}function renderNewTweetForm(){let e=document.getElementById("modal");e.classList.remove("hidden");let t=document.createElement("form");t.classList.add("new-tweet-form"),Formio.icons="fontawesome",Formio.createForm(t,getFormJSON("Tweet","Leave your thoughts here!","The content for your tweet...")).then(e=>e.on("submit",e=>submitTweet(e.data).then(e=>location.reload())));let n=getCloseModalButton(),o=document.createElement("div");o.classList.add("container");let s=document.createElement("h1");s.textContent="Post a Tweet",o.append(s,t,n),e.append(o)}function submitTweet(e){const t={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)};return fetch(BACKEND_URL+"/posts",t)}function addCommentToPost(e){const t={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)};return fetch(BACKEND_URL+`/posts/${e.post_id}`,t)}function likePost(e){const t={headers:{"Content-Type":"application/json"},method:"PATCH",body:JSON.stringify(e)};return fetch(BACKEND_URL+`/posts/${e}`,t).catch(e=>handleError(e))}function handleError(e){console.log("An error has occurred! We can't seme to communicate with our backend server at the moment."),console.log(e)}document.addEventListener("DOMContentLoaded",()=>{fetchAllPosts()});